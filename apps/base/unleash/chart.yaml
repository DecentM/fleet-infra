apiVersion: source.toolkit.fluxcd.io/v1
kind: HelmRepository
metadata:
  name: unleash
  namespace: app-unleash
spec:
  interval: 10m
  url: https://docs.getunleash.io/helm-charts
---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: unleash
  namespace: app-unleash
spec:
  interval: 10m
  chart:
    spec:
      chart: unleash
      version: ">=5.1.6"
      sourceRef:
        kind: HelmRepository
        name: unleash
        namespace: app-unleash
      interval: 10m
  values:
    replicaCount: 1
    postgresql:
      enabled: false
    image:
      pullPolicy: IfNotPresent
  valuesFrom:
    - kind: Secret
      name: postgres-cluster-app
      valuesKey: username
      targetPath: dbConfig.user
    - kind: Secret
      name: postgres-cluster-app
      valuesKey: password
      targetPath: dbConfig.pass
    - kind: Secret
      name: postgres-cluster-app
      valuesKey: dbname
      targetPath: dbConfig.database
    - kind: Secret
      name: postgres-cluster-app
      valuesKey: host
      targetPath: dbConfig.host
    - kind: Secret
      name: postgres-cluster-app
      valuesKey: port
      targetPath: dbConfig.port
