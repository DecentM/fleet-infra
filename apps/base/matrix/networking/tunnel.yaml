apiVersion: networking.cfargotunnel.com/v1alpha1
kind: TunnelBinding
metadata:
  name: matrix-stack-tunnel
  namespace: app-matrix
subjects:
  # Well-Known Federation Delegation (must be first for testing.borooka.ee)
  # Serves /.well-known/matrix/server and /.well-known/matrix/client
  - name: well-known
    spec:
      fqdn: testing.borooka.ee
      protocol: http
      target: http://well-known.app-matrix.svc:80

  # Matrix Synapse
  - name: synapse
    spec:
      fqdn: matrix-testing.borooka.ee
      protocol: http
      target: http://synapse.app-matrix.svc:8008

  # Element Web
  - name: element
    spec:
      fqdn: element-testing.borooka.ee
      protocol: http
      target: http://element.app-matrix.svc:8000

  # Jitsi Meet (Web)
  - name: jitsi-web
    spec:
      fqdn: meet-testing.borooka.ee
      protocol: http
      target: http://jitsi-web.app-matrix.svc:80

  # LiveKit Proxy (Element Call)
  # Routes /livekit/jwt → lk-jwt-service and /livekit/sfu → livekit
  - name: livekit-proxy
    spec:
      fqdn: livekit-testing.borooka.ee
      protocol: http
      target: http://livekit-proxy.app-matrix.svc:8000

tunnelRef:
  kind: ClusterTunnel
  name: cluster-tunnel-borooka
