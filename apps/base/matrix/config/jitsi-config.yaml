# Jitsi Meet configuration
# Documentation: https://jitsi.github.io/handbook/docs/devops-guide/devops-guide-docker
---
# Shared environment configuration for all Jitsi components
apiVersion: v1
kind: ConfigMap
metadata:
  name: jitsi-common-config
  namespace: app-matrix
data:
  # XMPP server configuration
  XMPP_DOMAIN: "meet.testing.borooka.ee"
  XMPP_SERVER: "prosody.app-matrix.svc"
  XMPP_AUTH_DOMAIN: "auth.meet.testing.borooka.ee"
  XMPP_MUC_DOMAIN: "muc.meet.testing.borooka.ee"
  XMPP_INTERNAL_MUC_DOMAIN: "internal-muc.meet.testing.borooka.ee"
  XMPP_GUEST_DOMAIN: "guest.meet.testing.borooka.ee"
  XMPP_RECORDER_DOMAIN: "recorder.meet.testing.borooka.ee"
  XMPP_CROSS_DOMAIN: "true"
  # Public URL for Jitsi Web
  PUBLIC_URL: "https://meet.testing.borooka.ee"
  # Timezone
  TZ: "UTC"
  # Enable P2P for direct peer connections
  P2P_ENABLED: "true"
  # JVB settings
  JVB_TCP_HARVESTER_DISABLED: "true"
  JVB_STUN_SERVERS: "meet-jit-si-turnrelay.jitsi.net:443"
---
# Prosody-specific configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: jitsi-prosody-config
  namespace: app-matrix
data:
  # Authentication configuration
  ENABLE_AUTH: "0"
  ENABLE_GUESTS: "1"
  AUTH_TYPE: "internal"
  # Logging
  LOG_LEVEL: "info"
  # TODO: Generate secure passwords and store in SealedSecret
  # Use: openssl rand -hex 16
  # JICOFO_AUTH_PASSWORD: "<from-secret>"
  # JVB_AUTH_PASSWORD: "<from-secret>"
  # JIBRI_RECORDER_PASSWORD: "<from-secret>"
  # JIBRI_XMPP_PASSWORD: "<from-secret>"
---
# Jicofo-specific configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: jitsi-jicofo-config
  namespace: app-matrix
data:
  JICOFO_AUTH_USER: "focus"
  JICOFO_COMPONENT_SECRET: "s3cr3t"
  # TODO: Generate and reference from SealedSecret
  # JICOFO_AUTH_PASSWORD: "<from-secret>"
---
# JVB (Jitsi Videobridge) specific configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: jitsi-jvb-config
  namespace: app-matrix
data:
  JVB_AUTH_USER: "jvb"
  JVB_BREWERY_MUC: "jvbbrewery"
  JVB_PORT: "10000"
  JVB_TCP_PORT: "4443"
  JVB_TCP_MAPPED_PORT: "4443"
  # TODO: Generate and reference from SealedSecret
  # JVB_AUTH_PASSWORD: "<from-secret>"
---
# Web-specific configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: jitsi-web-config
  namespace: app-matrix
data:
  ENABLE_WELCOME_PAGE: "1"
  ENABLE_CLOSE_PAGE: "0"
  ENABLE_PREJOIN_PAGE: "1"
  ENABLE_CALENDAR: "0"
  ENABLE_RECORDING: "0"
  DISABLE_HTTPS: "1"
  NGINX_WORKER_PROCESSES: "4"
  NGINX_WORKER_CONNECTIONS: "1024"
