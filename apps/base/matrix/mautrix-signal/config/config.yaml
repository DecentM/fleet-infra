# Mautrix Signal Bridge Configuration (bridgev2 format)
# Documentation: https://docs.mau.fi/bridges/go/signal/

# Network-specific configuration for Signal
network:
  device_name: "Matrix Bridge"

# Database configuration (top-level in bridgev2)
database:
  type: postgres
  uri: "postgres://${SIGNAL_DB_USER}:${SIGNAL_DB_PASSWORD}@mautrix-signal-db-rw.app-matrix.svc:5432/${SIGNAL_DB_NAME}?sslmode=disable"
  max_open_conns: 20
  max_idle_conns: 2

# Homeserver connection
homeserver:
  address: http://synapse-nginx-proxy.app-matrix.svc:8008
  domain: borooka.ee

# Appservice configuration
appservice:
  address: http://mautrix-signal.app-matrix.svc:29328
  hostname: 0.0.0.0
  port: 29328
  id: signal
  bot:
    username: signalbot
    displayname: Signal Bridge Bot
    avatar: mxc://maunium.net/wPJgTQbZOtpBFmDNkiNEMDUp
  as_token: "${SIGNAL_AS_TOKEN}"
  hs_token: "${SIGNAL_HS_TOKEN}"

# Bridge configuration
bridge:
  username_template: "signal_{{.}}"
  displayname_template: "{{.ProfileName}} (Signal)"
  # Allow users from this homeserver to use the bridge
  permissions:
    "*": relay
    "borooka.ee": user
    "@decentm:borooka.ee": admin
  # Double-puppeting (automatic when using same homeserver)
  double_puppet_server_map:
    borooka.ee: http://synapse-nginx-proxy.app-matrix.svc:8008
  login_shared_secret_map: {}
  # Message handling
  message_status_events: false
  delivery_receipts: false
  message_error_notices: true
  portal_message_buffer: 128
  # Encryption support
  # appservice: true - Use appservice transaction mode instead of /sync polling
  # Synapse 1.147+ no longer allows appservice users to /sync
  # Requires: msc3202_transaction_extensions + msc2409_to_device_messages_enabled in homeserver.yaml
  encryption:
    allow: true
    default: false
    appservice: true
    msc4190: true
    delete_keys:
      delete_outbound_on_ack: false
      dont_store_outbound: false
      ratchet_on_decrypt: false
      delete_fully_used_on_decrypt: false
      delete_prev_on_new_session: false
      delete_on_device_delete: false
      periodically_delete_expired: false
      delete_outdated_inbound: false
    verification_levels:
      receive: unverified
      send: unverified
      share: cross-signed-tofu

# Logging
logging:
  min_level: info
  writers:
    - type: stdout
      format: pretty-colored
