# Traefik ForwardAuth Middleware for Authelia
# Use this middleware on IngressRoutes to require authentication
# Reference: https://www.authelia.com/integration/proxies/traefik/
---
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: authelia-forwardauth
  namespace: app-authelia
spec:
  forwardAuth:
    # The authelia_url parameter tells Authelia where to redirect unauthenticated users for login
    # Without this, users may be incorrectly redirected to the domain root instead of the auth subdomain
    address: http://authelia.app-authelia.svc.cluster.local:9091/api/authz/forward-auth?authelia_url=https://auth.cluster.arpa
    trustForwardHeader: true
    authResponseHeaders:
      - Remote-User
      - Remote-Groups
      - Remote-Email
      - Remote-Name
